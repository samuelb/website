<!DOCTYPE html>
<html lang="de-de">
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		
		
		<title>pwrcmdr2</title>
		
		<link rel="stylesheet" href="https://reaktor23.org/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="https://reaktor23.org/css/font-awesome.min.css"/>
		<link rel="stylesheet" href="https://reaktor23.org/css/style.css"/>
		<link rel="stylesheet" href="https://reaktor23.org/css/opensans.css"/>
		<link rel="stylesheet" href="https://reaktor23.org/css/featherlight.min.css"/>
		<meta name="theme-color" content="#46b71d">
		
	</head>
	<body>
		<a href="https://github.com/reaktor23/website" class="github-corner d-none d-sm-block" aria-label="View source on Github">
  <svg width="80" height="80" viewBox="0 0 250 250" style="fill: #46b71d; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
    <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
  </svg>
</a>
<style>
  .github-corner:hover .octo-arm {
    animation:octocat-wave 560ms ease-in-out
  }
  @keyframes octocat-wave {
    0%, 100% { transform:rotate(0) }
    20%, 60% { transform:rotate(-25deg) }
    40%, 80% { transform:rotate(10deg) }
  }
  @media (max-width:500px) {
    .github-corner:hover .octo-arm {
      animation:none
    }
    .github-corner .octo-arm {
      animation:octocat-wave 560ms ease-in-out
    }
  }
</style>

		<div class="container" role="main">
		<header>
	<nav class="navbar navbar-expand-md mb-4 navbar-light">
		<a href="https://reaktor23.org" class="navbar-brand mr-5"><img src="/img/logo.png" alt="Reaktor23 - Hackerspace"></a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav">
				
				
				<li class="nav-item mr-3">
					<a href="/blog/" class="nav-link">Blog</a>
				</li>
				
				<li class="nav-item mr-3">
					<a href="/about/" class="nav-link">About</a>
				</li>
				
				<li class="nav-item mr-3">
					<a href="/projects/" class="nav-link">Projects</a>
				</li>
				
				<li class="nav-item mr-3">
					<a href="/talks/" class="nav-link">Talks</a>
				</li>
				
			</ul>
		</div>
        <div id="reaktorstatus" class="text-center">
            Reaktor status:
            <div id="message" class="text-success"></div>
            <div class="small"><a href="/status/"><i class="fa fa-info-circle" aria-hidden="true"></i></a></div>
        </div>
	</nav>
</header>


		
<article>
    <header>
        <h1 class="headline my-3"><a href="https://reaktor23.org/projects/pwrcmdr2/">pwrcmdr2</a></h1>
        <div class="meta">
            
            <span class="author">by Bouni 
                 - 
            </span>
            
            
            <time datetime="2018-10-17">2018-10-17</time>
            
        </div>
        <div>
        <div class="project-image-frame">
            <img class="project-image-single" src="pwrcmdr2.png" alt="Project image">
        </div>
        </div>
    </header>
    
    <div class="alert alert-success" role="alert">
<p>Wir haben noch 4 Platinen für den pwrCMDer übrig und würden diese gerne gratis an andere Hackerspaces abgeben wenn Interesse besteht.
Eine Liste mit Bauteilen für die Bestellung bei Pollin ist ebenfalls vorhanden.
Der einzige Knackpunkt ist das ein kleiner Layoutfehler bei den Optokopplern unterlaufen ist und das Pinout nicht stimmt.
Das kann aber mit ein wenig gutem altem Pfusch<sup><i class="fa fa-trademark" aria-hidden="true"></i></sup> behoben werden (genauere Infos auf Anfrage).</p>
</div>
<h1 id="warum">Warum?</h1>
<p>Unser <strike>aktueller</strike> bisheriger pwrCMDr bestand aus einem Arduino-Ethernet auf einer selbstgeätzten Platine.
Da wir immer wieder Probleme damit haben sollte etwas neues her, das vielleicht etwas mehr Spielraum gibt um Änderungen/Verbesserungen zu integrieren.</p>
<h1 id="hardware">Hardware</h1>
<h2 id="board">Board</h2>
<p>Wir haben uns für ein RaspberryPi 3 B+ entschieden, das ist ausreichend flott udn erfüllt alle unsere Wunschkriterien.
Ausserdem ist es sehr viel einfacher zu bekommen als die etwas günstigeren Verterter von z.B. Aliexpress (BananaPi, etc.)</p>
<h2 id="formfaktor">Formfaktor</h2>
<p>Das Raspberry Pi kommt in ein Hutschienengehäuse von <a href="https://www.pollin.de/p/hutschienen-gehaeuse-fuer-raspberry-pi-model-b-8te-702341">Pollin</a>.
Dieses hat ausreichend Platz für einen <a href="https://www.raspberrypi.org/blog/introducing-raspberry-pi-hats/">HAT</a> auch wenn wir uns nicht an die genauen Specs halten.</p>
<h2 id="spannungsversorgung">Spannungsversorgung</h2>
<p>Wir versorgen das Board mit 24VDC da wir das eh im Schaltschrank verwenden. Das RPi wird über die Stiftleisten mit 5VDC versorgt womit die Notwendigkeit eines USB Netzteil entfällt.
Die 5V werden von einem <a href="https://de.aliexpress.com/item/-/32830931596.html">AliExpress DC/DC Wandler</a> generiert der auf dem Board verlötet wird.</p>
<h2 id="funktionen">Funktionen</h2>
<h3 id="schützsteuerung">Schützsteuerung</h3>
<p>Wir haben wieder unsere zweikanalige Schützsteuerung verbaut, diese ist so ausgelegt das sie zwei Externe Schütze die unsere beiden Stromkreise schalten ein bzw. ausschalten können.
Dabei war uns wichtig das das auch funktionieren muss wenn der PowerCommander einmal einen Ausfall haben sollte.
Deshalb schalten die 4 Relais einfach eine Selbsthaltung der Schütze, parallel dazu gibt es noch extern verbaute Hardware Taster damit sich das ganze auch wie bereits erwähnt im Notfall schalten lässt.</p>
<h2 id="ein--und-ausgänge">Ein- und Ausgänge</h2>
<p>Das Board verfügt über 4 Relais Ausgänge, dabei lässt sich über einen Lötjumper wählen ob der betreffende Kanal Schliesser oder Öffner sein soll.
Desweiteren hat das Board 8 Digitaleingänge die 24V tollerant sind und mittels Optokopplern getrennt sind.</p>
<h2 id="sensorik">Sensorik</h2>
<p>Es sind ein I2C, ein 1-Wire und ein RS485 Port vorhanden. Über diese wollen wir diverse Sensorik anbinden.</p>
<h1 id="software">Software</h1>
<p><del>Wir haben <a href="https://www.home-assistant.io/hassio/">Hassio</a>, eine speziell auf das RaspberryPi zugeschnittene Distribution von <a href="https://www.home-assistant.io">Home Assistant</a> auf dem RaspberryPi installiert.</del></p>
<p>Da wir immer wieder Probleme mit Hassio hatten (Micro SD Card corruption) haben wir ein Raspbian Buster installiert und darauf dann <a href="https://www.home-assistant.io">Home Assistant</a> via <a href="https://github.com/reaktor23/pwrcmder/">docker-compose</a>.
Die Datenbank ist jetzt ein Postgres das auf unserem actse server läuft und eintsprechend in der HA config konfiguriert ist. Dies sollte die Schreibzyklen auf die SD Karte möglichst gering halten.</p>
<p>Das hat sehr viele Vortiele für uns:</p>
<ul>
<li>Ansteuerungen der GPIOs via Webinterface und/oder REST API (<a href="https://www.home-assistant.io/components/rpi_gpio/">rpi_gpio</a>)</li>
<li>Auslesen der 1-Wire Temperatursensoren (<a href="https://www.home-assistant.io/components/sensor.onewire/">sensor.onewire</a>)</li>
<li>Bereitstellen des Reaktorstatus via SpaceAPI (<a href="https://www.home-assistant.io/components/spaceapi/">spaceapi</a>)</li>
</ul>
<p>Ausserdem die einfache Konfiguration via YAML files und das ermöglichen von Automations und vielen weiteren coolen Features!</p>
<p>So sieht das interface in seiner ersten Version aus, hier bietet sich noch viel Spielraum für Erweiterungen :-)</p>


<figure class="figure m-1">
    <a href="/projects/pwrcmdr2/2020-10-13-ha-1.png" data-featherlight="image">
        <img src="/projects/pwrcmdr2/2020-10-13-ha-1_huc374afc6c16656cb66bb48c31d514cd1_127927_600x0_resize_lanczos_3.png" class="figure-img img-thumbnail " width="600">
    </a>
    
</figure>



<figure class="figure m-1">
    <a href="/projects/pwrcmdr2/2020-10-13-ha-2.png" data-featherlight="image">
        <img src="/projects/pwrcmdr2/2020-10-13-ha-2_hu6ca734c8c252ada5418509c64fbcb941_89335_600x0_resize_lanczos_3.png" class="figure-img img-thumbnail " width="600">
    </a>
    
</figure>

<h2 id="known-bugs">Known Bugs</h2>
<h3 id="rpi_gpio">rpi_gpio</h3>
<p>Die Eingänge werden über die rpi_gpio integration abgefragt und lösen ein event aus, allerdings kann es passieren das wenn der Kontakt prellt das der state nicht stimmt was sehr unglücklich ist.
Als Workaround haben wir das <code>rpi_gpio</code> Verzeichnis von <a href="https://github.com/home-assistant/core/tree/dev/homeassistant/components/rpi_gpio">GitHub</a> nach config/custom_components/rpi_gpio kopiert und die Zeile 75 in der Datei <code>switch.py</code> geändert das sie True zurückgibt.
Dadurch wird die rpi_gpio integration als custom_component geladen und verhindert das laden der Originalen Integration.</p>
<pre tabindex="0"><code>    @property
    def should_poll(self):
        &quot;&quot;&quot;No polling needed.&quot;&quot;&quot;
        return True
</code></pre><p>Es wird zwar gewarnt das dies die CPU Last erhöht, allerdings konnten wir keine Nachteile durch diese Methode erkennen.</p>

</article>

		</div>
	<footer>
    <div class="footer-copyright text-center py-3 text-muted">
            <a href="/impressum/" class="text-muted">Impressum / Datenschutz</a>

        
            <div class="d-sm-inline">
                <span class="px-2 d-none d-sm-inline">&bull;</span>
                <i class="fa fa-rss text-muted mr-1" style="font-size: 1.25rem" aria-hidden="true"></i>
                
                    <a href="/index.xml" class="text-muted">All</a>
                 | 
                    <a href="/blog/index.xml" class="text-muted">Blog</a>
                 | 
                    <a href="/projects/index.xml" class="text-muted">Projects</a>
                </div><span class="px-2 d-none d-sm-inline">&bull;</span>

        <a href="https://github.com/reaktor23">
            <i class="fa fa-github text-muted" style="font-size: 1.25rem;" aria-hidden="true"></i>
        </a>

        <br />

        <span style="font-size: 0.7em;">build time: 2022-10-03 23:39 UTC</span>
    </div>
</footer>

	<script src="https://reaktor23.org/js/jquery.min.js"></script>
<script src="https://reaktor23.org/js/showdown.min.js"></script>
<script src="https://reaktor23.org/js/bootstrap.min.js"></script>
<script src="https://reaktor23.org/js/featherlight.min.js"></script>
<script src="https://reaktor23.org/js/reaktorstatus.js"></script>
<script src="https://reaktor23.org/js/talks.js"></script>

</body>
</html>
